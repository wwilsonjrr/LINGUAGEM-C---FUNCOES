/*
69. Fa√ßa um programa que fa√ßa opera√ß√µes simples de fra√ß√µes:
- Leia duas fra√ß√µes (como string, ex: 3/4)
- Simplifique as fra√ß√µes
- Apresente soma, subtra√ß√£o, produto e quociente
Obs.: Crie uma fun√ß√£o para cada item.
üîπ scanf ‚Üí l√™ do teclado
üîπ sscanf ‚Üí l√™ de uma string
*/

// Biblioteca para entrada e sa√≠da (printf, fgets, sscanf)
#include <stdio.h>

// Biblioteca para fun√ß√µes matem√°ticas auxiliares (abs)
#include <stdlib.h>

// Biblioteca para manipula√ß√£o de strings (strcspn)
#include <string.h>

// -----------------------------------------------------------------------------
// Estrutura que representa uma fra√ß√£o matem√°tica
// -----------------------------------------------------------------------------
struct Fracao
{
    int num; // armazena o numerador da fra√ß√£o
    int den; // armazena o denominador da fra√ß√£o
};

// -----------------------------------------------------------------------------
// Fun√ß√£o que calcula o MDC (M√°ximo Divisor Comum)
// Usada para simplificar fra√ß√µes
// -----------------------------------------------------------------------------
int mdc(int a, int b)
{
    // Garante que os valores sejam positivos
    a = abs(a);
    b = abs(b);

    // Algoritmo de Euclides
    while (b != 0)              // enquanto o segundo n√∫mero n√£o for zero
    {
        int resto = a % b;      // calcula o resto da divis√£o de a por b
        a = b;                  // atualiza a com o valor de b
        b = resto;              // atualiza b com o resto
    }

    // Se ambos forem zero, retorna 1 para evitar divis√£o por zero
    if (a == 0 && b == 0)
        return 1; // Porque 1 √© o √∫nico n√∫mero que N√ÉO altera nada quando divide.

    // Retorna o MDC encontrado
    return a;
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que simplifica uma fra√ß√£o dividindo pelo MDC
// -----------------------------------------------------------------------------


//A fun√ß√£o simplificar recebe uma struct Fracao chamada f
struct Fracao simplificar(struct Fracao f)
{
    // Calcula o MDC entre numerador e denominador
    int d = mdc(f.num, f.den);

    // Divide numerador e denominador pelo MDC
    f.num /= d;
    f.den /= d;

    // Se o denominador ficar negativo,
    // passa o sinal para o numerador
    if (f.den < 0)
    {
        f.num = -f.num;
        f.den = -f.den;
    }

    // Retorna a fra√ß√£o simplificada
    return f;
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que l√™ uma fra√ß√£o digitada como string (ex: 3/4)
// -----------------------------------------------------------------------------
struct Fracao lerFracao(void) // Esta fun√ß√£o n√£o recebe nenhum par√¢metro
{
    struct Fracao f;    // vari√°vel que armazenar√° a fra√ß√£o lida
    char linha[50];     // string para ler a entrada do usu√°rio

    while (1)           // la√ßo infinito at√© o usu√°rio digitar corretamente
    {
        printf("Digite a fracao (ex: 3/4): ");

        // L√™ a linha digitada (inclui o '\n')
        fgets(linha, sizeof(linha), stdin);

        // Remove o '\n' deixado pelo fgets
        linha[strcspn(linha, "\n")] = '\0';

        // Tenta extrair dois inteiros no formato a/b
        if (sscanf(linha, "%d/%d", &f.num, &f.den) == 2) // Como o formato tem dois %d, o valor correto √© 2
        {
            // Verifica se o denominador √© v√°lido
            if (f.den != 0)
            {
                return f; // leitura correta, retorna a fra√ß√£o
            }
            else
            {
                printf("Erro: denominador nao pode ser zero!\n");
            }

        }
        else
        {
            // Caso a string n√£o esteja no formato correto
            printf("Entrada invalida. Use algo como 3/4.\n");
        }
    }
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que soma duas fra√ß√µes
// F√≥rmula: a/b + c/d = (ad + bc) / bd
// struct n√£o tem operadores aritm√©ticos definidos
// -----------------------------------------------------------------------------
struct Fracao somar(struct Fracao a, struct Fracao b)
{
    struct Fracao r;                 // fra√ß√£o resultado

    r.num = a.num * b.den            // ad
          + b.num * a.den;           // + bc

    r.den = a.den * b.den;           // bd

    // Retorna a fra√ß√£o j√° simplificada
    return simplificar(r);
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que subtrai duas fra√ß√µes
// F√≥rmula: a/b - c/d = (ad - bc) / bd
// -----------------------------------------------------------------------------
struct Fracao subtrair(struct Fracao a, struct Fracao b)
{
    struct Fracao r;

    r.num = a.num * b.den            // ad
          - b.num * a.den;           // - bc

    r.den = a.den * b.den;

    return simplificar(r);
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que multiplica duas fra√ß√µes
// F√≥rmula: (a/b) * (c/d) = ac / bd
// -----------------------------------------------------------------------------
struct Fracao multiplicar(struct Fracao a, struct Fracao b)
{
    struct Fracao r;

    r.num = a.num * b.num;           // ac
    r.den = a.den * b.den;           // bd

    return simplificar(r);
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que divide duas fra√ß√µes
// F√≥rmula: (a/b) √∑ (c/d) = (a/b) * (d/c)
// -----------------------------------------------------------------------------
struct Fracao dividir(struct Fracao a, struct Fracao b)
{
    struct Fracao r;

    // N√£o √© permitido dividir por uma fra√ß√£o com numerador zero
    if (b.num == 0)
    {
        printf("Erro: divisao por zero.\n");

        // Retorna fra√ß√£o neutra (0/1)
        r.num = 0;
        r.den = 1;
        return r;
    }

    r.num = a.num * b.den;           // ad
    r.den = a.den * b.num;           // bc

    return simplificar(r);
}

// -----------------------------------------------------------------------------
// Fun√ß√£o que exibe uma fra√ß√£o na tela
// -----------------------------------------------------------------------------
void exibirFracao(struct Fracao f)
{
    // Se o denominador for 1, exibe apenas o n√∫mero
    if (f.den == 1)
        printf("%d", f.num);
    else
        printf("%d/%d", f.num, f.den);

    return;
}

// -----------------------------------------------------------------------------
// Fun√ß√£o principal
// -----------------------------------------------------------------------------
int main(void)
{
    struct Fracao p, q;   // declara duas fra√ß√µes

    printf("=== Operacoes com Fracoes ===\n\n");

    // L√™ a primeira fra√ß√£o
    printf("Digite a fracao p:\n");
    p = lerFracao();

    // L√™ a segunda fra√ß√£o
    printf("Digite a fracao q:\n");
    q = lerFracao();

    // Simplifica ambas
    p = simplificar(p);
    q = simplificar(q);

    // Exibe as fra√ß√µes simplificadas
    printf("\nFracao p simplificada: ");
    exibirFracao(p);

    printf("\nFracao q simplificada: ");
    exibirFracao(q);

    printf("\n\n===== RESULTADOS =====\n");

    // Exibe soma
    printf("Soma: ");
    exibirFracao(somar(p, q));

    // Exibe subtra√ß√£o
    printf("\nSubtracao: ");
    exibirFracao(subtrair(p, q));

    // Exibe produto
    printf("\nProduto: ");
    exibirFracao(multiplicar(p, q));

    // Exibe quociente
    printf("\nQuociente: ");
    exibirFracao(dividir(p, q));

    printf("\n");

    // Finaliza o programa
    system("pause");
    return 0;
}
